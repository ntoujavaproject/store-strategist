# 🏗️ 餐廳分析器 - 完整程式架構說明

## 📋 目錄
1. [專案概述](#專案概述)
2. [系統架構圖](#系統架構圖)
3. [核心程式碼詳細說明](#核心程式碼詳細說明)
4. [模組架構圖](#模組架構圖)
5. [數據流程圖](#數據流程圖)
6. [技術架構分層](#技術架構分層)
7. [外部服務整合架構](#外部服務整合架構)
8. [部署架構](#部署架構)

---

## 🎯 專案概述

**餐廳分析器** 是一個基於 JavaFX 的智能餐廳分析桌面應用程式，整合本地 AI 引擎與雲端服務，為餐廳經營者提供全方位的數據分析和營運建議。

### 🚀 核心技術
- **前端框架**: JavaFX 21 (桌面 GUI)
- **後端語言**: Java 21 + Python 3.11
- **AI 引擎**: Ollama + Gemma 3:4B (本地運行)
- **雲端服務**: Firebase (Firestore + Storage)
- **搜索引擎**: Algolia + Google Places API
- **數據收集**: Python 爬蟲 + BeautifulSoup

---

## 🏗️ 系統架構圖

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              🎨 用戶界面層 (Presentation Layer)                │
├─────────────────┬─────────────────┬─────────────────┬─────────────────────────┤
│  SearchHomePage │   MainInterface │     AIChat      │      Settings Panel     │
│     搜索首頁      │    主分析界面     │   AI 對話系統    │        設定面板          │
│                │                 │                 │                         │
│  SearchBar     │   RightPanel    │  ChatHistory    │   PreferencesManager    │
│   智能搜索欄     │   右側資訊面板    │   對話記錄       │      偏好設定管理         │
│                │                 │                 │                         │
│  TabManager    │   RecentReviews │  AIProgress     │   UIManager            │
│   分頁管理      │   近期評論側欄    │   AI 進度對話框   │      UI 狀態管理        │
└─────────────────┴─────────────────┴─────────────────┴─────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           💼 業務邏輯層 (Business Logic Layer)                │
├─────────────────┬─────────────────┬─────────────────┬─────────────────────────┤
│   DataManager   │   UIManager     │   AIManager     │    SearchService        │
│    數據管理中心   │   界面管理器     │   AI 管理器      │       搜索服務           │
│                │                 │                 │                         │
│ RatingAnalyzer  │ AnimationMgr    │ OllamaManager   │ AlgoliaSearch          │
│   評分數據分析   │   動畫效果管理    │  Ollama 引擎管理 │   Algolia 搜索整合      │
│                │                 │                 │                         │
│ ExpenseManager  │ ResourceMgr     │ ChatAdvisor     │ GooglePlacesService    │
│   消費數據管理   │   資源檔案管理    │  聊天諮詢顧問    │   Google Places 整合    │
└─────────────────┴─────────────────┴─────────────────┴─────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          💾 數據存取層 (Data Access Layer)                   │
├─────────────────┬─────────────────┬─────────────────┬─────────────────────────┤
│   Firebase      │   Google APIs   │   Local Cache   │     Ollama AI           │
│    雲端數據庫    │   外部 API 服務  │    本地快取      │      本地 AI 引擎        │
│                │                 │                 │                         │
│ • Firestore    │ • Places API    │ • JSON Files    │ • Gemma 3:4B Model     │
│ • Storage      │ • Maps API      │ • Preferences   │ • Local Inference      │
│ • Real-time    │ • Search API    │ • Temp Files    │ • Chat History         │
└─────────────────┴─────────────────┴─────────────────┴─────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        🐍 Python 數據收集層 (Data Collection Layer)           │
├─────────────────┬─────────────────┬─────────────────┬─────────────────────────┤
│ Restaurant Scraper │ Review Collector │ Rating Analyzer │ Data Processor       │
│   餐廳資料爬蟲      │    評論收集器     │    評分分析器    │      數據處理器       │
│                   │                 │                 │                      │
│ • Google Maps     │ • Review Text   │ • Statistical   │ • Data Cleaning      │
│ • Basic Info      │ • User Ratings  │ • Trend Analysis│ • Format Conversion  │
│ • Location Data   │ • Photo URLs    │ • Sentiment     │ • Validation         │
└─────────────────┴─────────────────┴─────────────────┴─────────────────────────┘
```

---

## 🧩 核心程式碼詳細說明

### 📱 應用程式入口層

#### 🚀 AppLauncher.java (295 行)
**功能**: 應用程式主啟動器和智能初始化管理器
- **系統環境檢測**: 檢查作業系統版本、Java 環境、記憶體狀況
- **AI 服務預檢**: 驗證 Ollama 安裝狀態和 AI 模型可用性
- **依賴項驗證**: 確保所有必要的函式庫和服務正常運作
- **優雅啟動**: 提供進度指示和錯誤處理機制

#### 🎮 compare.java (3554 行) - 主控制器
**功能**: 應用程式的核心控制器，協調所有功能模組
- **界面管理**: 管理主視窗、分頁、面板的布局和切換
- **事件協調**: 處理用戶交互事件，協調各模組間的通訊
- **響應式布局**: 根據視窗大小自動調整界面布局（水平/垂直）
- **生命週期管理**: 處理應用程式的啟動、運行和關閉流程
- **狀態監聽**: 實現多個狀態監聽器接口，響應各種狀態變化

### 🎨 用戶界面模組

#### 🏠 SearchHomePage.java (619 行)
**功能**: 搜索首頁和餐廳選擇界面
- **搜索入口**: 提供餐廳名稱輸入和搜索功能
- **歷史記錄**: 顯示最近搜索的餐廳列表
- **快速選擇**: 支援從本地數據庫快速選擇已分析餐廳
- **界面動畫**: 提供平滑的頁面切換動畫效果

#### 🔍 SearchBar.java (604 行)
**功能**: 智能搜索欄和自動完成系統
- **即時搜索**: 輸入時即時提供搜索建議
- **模糊匹配**: 使用 Levenshtein Distance 算法進行智能匹配
- **多源搜索**: 整合 Algolia、Google Places 和本地數據
- **搜索歷史**: 記錄和管理用戶搜索歷史

#### 📊 RightPanel.java (912 行)
**功能**: 右側資訊面板和數據視覺化
- **評分展示**: 顯示餐廳評分分布和趨勢圖表
- **評論顯示**: 展示顧客評論和情感分析結果
- **照片畫廊**: 餐廳照片的網格展示和全螢幕檢視
- **統計資料**: 各種營運數據的圖表化展示

#### 📑 TabManager.java (400 行)
**功能**: 分頁管理和多餐廳比較
- **分頁創建**: 動態創建和管理餐廳分析分頁
- **數據切換**: 在不同餐廳數據間快速切換
- **比較功能**: 支援多個餐廳的並排比較分析
- **分頁持久化**: 保存和恢復分頁狀態

#### 📝 RecentReviewsSidebar.java (510 行)
**功能**: 近期評論側邊欄和評論管理
- **時間篩選**: 按時間範圍篩選顯示評論
- **評論排序**: 支援多種評論排序方式
- **快速瀏覽**: 提供評論的快速瀏覽和搜索功能
- **評論統計**: 顯示評論數量和評分統計

### 🤖 AI 智能模組

#### 🧠 OllamaManager.java (811 行)
**功能**: Ollama AI 引擎核心管理器
- **服務管理**: 管理 Ollama 服務的啟動、監控和關閉
- **模型管理**: 處理 AI 模型的下載、載入和版本管理
- **推理處理**: 處理自然語言查詢和生成回應
- **上下文管理**: 維護對話上下文和餐廳相關信息
- **錯誤處理**: 完善的異常處理和服務恢復機制

#### 💬 AIChat.java (502 行)
**功能**: AI 聊天界面和對話管理
- **對話界面**: 提供聊天式的用戶交互界面
- **訊息渲染**: 美化的訊息顯示和格式化
- **輸入處理**: 處理用戶輸入和指令解析
- **實時回應**: 顯示 AI 思考狀態和即時回應

#### 📚 ChatHistoryManager.java (480 行)
**功能**: 聊天記錄管理和搜索
- **記錄存儲**: 持久化保存所有對話記錄
- **搜索功能**: 在歷史對話中快速搜索關鍵內容
- **分類整理**: 按餐廳、日期等條件組織對話記錄
- **匯出功能**: 支援對話記錄的匯出和備份

#### 🎯 AIProgressDialog.java (393 行)
**功能**: AI 初始化進度顯示對話框
- **進度展示**: 視覺化顯示 AI 初始化進度
- **狀態回報**: 詳細的初始化狀態和錯誤信息
- **用戶交互**: 提供取消和重試選項
- **動畫效果**: 平滑的進度條和載入動畫

#### 🧪 FirestoreRestaurantAnalyzer.java (240 行)
**功能**: 基於雲端數據的餐廳智能分析
- **數據分析**: 分析 Firestore 中的餐廳數據
- **趨勢預測**: 基於歷史數據預測營運趨勢
- **比較分析**: 與同類型餐廳進行比較分析
- **建議生成**: 生成具體的營運改進建議

#### 🎪 AIAnalysisIntegration.java (403 行)
**功能**: AI 分析功能整合和協調
- **功能整合**: 整合各種 AI 分析功能
- **流程管理**: 管理複雜的分析流程和步驟
- **結果整合**: 整合來自不同來源的分析結果
- **報告生成**: 生成綜合性的分析報告

### 📊 數據管理模組

#### 💾 DataManager.java (484 行)
**功能**: 數據管理中心和協調器
- **數據源整合**: 統一管理來自不同源的數據
- **快取策略**: 實現多層快取機制提升效能
- **數據同步**: 處理本地和雲端數據的同步
- **數據驗證**: 確保數據完整性和一致性

#### 🌐 GooglePlacesService.java (179 行)
**功能**: Google Places API 整合服務
- **餐廳搜索**: 透過 Google Places API 搜索餐廳
- **基本資訊**: 獲取餐廳的基本信息和評分
- **評論數據**: 抓取顧客評論和評分數據
- **照片下載**: 下載餐廳相關照片

#### 💰 FirebaseExpenseManager.java (293 行)
**功能**: Firebase 消費數據管理
- **消費數據**: 管理餐廳的消費水平數據
- **價位分析**: 分析不同價位區間的分布
- **成本預測**: 基於歷史數據預測成本趨勢
- **雲端同步**: 與 Firebase 進行數據同步

#### 📈 RatingDataAnalyzer.java (322 行)
**功能**: 評分數據分析和統計
- **評分統計**: 計算各種評分統計指標
- **趨勢分析**: 分析評分的時間趨勢變化
- **分布分析**: 分析評分的分布特徵
- **預測模型**: 建立評分預測模型

### 🔧 系統管理模組

#### 🎛️ UIManager.java (902 行)
**功能**: UI 狀態和主題管理
- **主題切換**: 管理深色/淺色主題切換
- **狀態監控**: 監控各種 UI 狀態變化
- **布局管理**: 管理響應式布局和視窗調整
- **事件分發**: 分發和處理 UI 相關事件

#### ⚙️ PreferencesManager.java (355 行)
**功能**: 用戶偏好設定管理
- **設定存儲**: 持久化保存用戶設定
- **偏好同步**: 在不同元件間同步用戶偏好
- **預設值管理**: 管理各種設定的預設值
- **設定驗證**: 驗證設定值的有效性

#### 🎨 AnimationManager.java (383 行)
**功能**: UI 動畫效果管理
- **過渡動畫**: 管理頁面和元件的過渡動畫
- **載入動畫**: 提供各種載入狀態的動畫效果
- **互動動畫**: 處理用戶交互的視覺回饋動畫
- **性能優化**: 優化動畫效能和流暢度

#### 📦 ResourceManager.java (117 行)
**功能**: 應用程式資源檔案管理
- **資源載入**: 統一管理圖示、樣式等資源檔案
- **路徑管理**: 處理資源檔案的路徑和定位
- **快取機制**: 實現資源檔案的快取機制
- **錯誤處理**: 處理資源載入失敗的情況

### 🔍 搜索功能模組

#### 🔎 AlgoliaRestaurantSearch.java (181 行)
**功能**: Algolia 搜索引擎整合
- **搜索索引**: 管理餐廳數據的搜索索引
- **即時搜索**: 提供即時的搜索建議和結果
- **搜索優化**: 優化搜索演算法和結果排序
- **API 整合**: 與 Algolia 服務進行 API 整合

### 🐍 Python 數據收集模組

#### 🌟 featured_collector.py (497 行)
**功能**: 精選評論和照片智能收集器
- **智能評論篩選**: 基於多維度評分系統篩選高品質評論
  - 評論者權威性 (35%): 評論總數、照片總數
  - **在地嚮導優先**: 在地嚮導身份額外+20%權威性加分，降低篩選門檻
  - 內容質量評分 (35%): 評論長度、照片數量、詳細評分
  - 時間新近性 (20%): 越新的評論評分越高
  - 星級評分 (10%): 4星以上評論優先
- **在地嚮導特殊處理**:
  - 自動識別「在地嚮導」和「Local Guide」身份
  - 權威性門檻從0.5降低至0.3 (更容易被選為精選)
  - 在排序中獲得權威性加分優勢
- **照片品質篩選**: 優先收集有照片的4星以上評論
- **數據導出功能**: 將精選結果導出為結構化JSON格式
- **Firestore 上傳**: 實現自動重試機制的雲端數據上傳功能
- **錯誤處理**: 完善的異常處理和數據驗證機制

#### 🏪 restaurant.py (249 行)
**功能**: 餐廳數據模型和Google Maps爬蟲核心
- **數據模型定義**: 定義餐廳基本資訊(ID、名稱、地址)和評論列表結構
- **智能評論爬取**: 從Google Maps API獲取評論，支援4種排序方式：
  - 最相關 (Most Relevant) - sorted_by=1
  - 最新 (Newest) - sorted_by=2
  - 評分最高 (Highest Rating) - sorted_by=3
  - 評分最低 (Lowest Rating) - sorted_by=4
- **多層數據提取**: 從複雜的JSON結構中提取17個評論字段：
  - 評論者資訊: 名稱、狀態、ID、總評論數、總照片數
  - 評論內容: 星級、評論文字、照片URL、評論日期
  - 用餐資訊: 服務類型、用餐類型、消費金額
  - 評分詳情: 食物、服務、環境分數
- **Firestore 上傳**: 實現自動重試機制的雲端數據上傳功能
- **錯誤處理**: 完善的異常處理和數據驗證機制

#### 📊 rating_analyzer.py (363 行)
**功能**: 餐廳評分數據統計分析器
- **Firestore 數據獲取**: 從雲端數據庫獲取指定餐廳的所有評論數據
- **多源查詢策略**: 主查詢(子集合)失敗時自動切換到備用查詢(主集合)
- **五維評分分析**: 分析餐點、服務、環境、價格、總評等五個維度的評分
- **統計計算功能**:
  - 平均值計算 (calculate_average_ratings)
  - 評分分布統計 (calculate_rating_distribution)
  - 時間趨勢分析 (calculate_rating_trends)
  - 異常值檢測和過濾
- **智能價格評分**: 根據消費金額字串智能推算價格滿意度評分
- **數據驗證**: 嚴格的評分範圍驗證(1-5分制)和數據類型檢查
- **圖表數據生成**: 為前端圖表組件提供格式化的統計數據

#### 🛠️ utils.py (312 行)
**功能**: 通用工具函數庫和搜索引擎
- **Firebase 數據管理**:
  - get_all_restaurants_id_on_firebase(): 獲取所有已存在的餐廳ID
  - 分頁數據獲取和集合去重功能
- **智能搜索系統**:
  - search_restaurants_id_in_radius(): 圓形區域餐廳搜索
  - search_restaurants_id_in_area(): 大範圍網格搜索
  - get_restaurant_id_by_name(): 根據名稱搜索餐廳ID
  - get_restaurant_info_by_id(): 根據ID獲取餐廳詳細資訊
- **多線程爬蟲**: 使用ThreadPoolExecutor提升搜索效率
- **地理計算**: 經緯度網格劃分和距離計算
- **多類型場所搜索**: 餐廳、酒吧、咖啡店、外帶店、外送服務
- **數據持久化**: save_restaurants_to_json() JSON格式數據導出
- **重試機制**: 網路請求失敗時的指數退避重試策略

#### 📝 review.py (38 行)
**功能**: 評論數據結構定義
- **評論模型**: 定義標準化的評論數據結構
- **數據字段**: 包含評論者、評分、內容、時間等完整信息
- **類型安全**: 確保評論數據的類型一致性和完整性

#### 🔧 search_res_by_name_upload_firebase.py (116 行)
**功能**: 命令行餐廳搜索和上傳工具
- **命令行介面**: 支援命令行參數和交互式輸入
- **完整工作流程**:
  1. 根據餐廳名稱搜索Google Maps獲取餐廳ID
  2. 使用ID獲取餐廳詳細資訊(名稱、地址)
  3. 爬取該餐廳的所有評論數據
  4. 將餐廳和評論數據上傳到Firestore
- **錯誤處理**: 詳細的錯誤分類和用戶友好的錯誤信息
- **執行結果報告**: 提供詳細的上傳統計信息
- **退出碼管理**: 正確的程式退出碼設定

#### 🌍 search_res_in_area_upload_firebase.py (46 行)
**功能**: 區域餐廳批量收集工具
- **區域搜索**: 在指定地理區域內批量搜索餐廳
- **批量處理**: 自動處理多個餐廳的數據收集和上傳
- **進度追蹤**: 實時顯示批量處理進度
- **重複檢測**: 避免重複收集已存在的餐廳數據

#### ⚙️ config.py (11 行)
**功能**: 全域配置管理
- **地理配置**: 預設搜索中心點座標(台北地區)
- **搜索參數**: 預設搜索半徑(2000公尺)
- **Firebase配置**: Firebase專案ID設定
- **API配置**: Google Maps API端點和HTTP標頭設定
- **請求配置**: 模擬瀏覽器的User-Agent設定

#### 🔄 update_res_data.py (21 行)
**功能**: 餐廳數據更新工具
- **增量更新**: 更新已存在餐廳的最新評論數據
- **數據同步**: 保持本地和雲端數據的一致性

---

## 🎯 模組架構圖

```
                    ┌─────────────────────────────────────┐
                    │              🚀 App Layer          │
                    │         AppLauncher.java           │
                    │       CustomSplashScreen.java      │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │           🎮 Controller Layer       │
                    │           compare.java              │
                    │         (3554 lines - 主控制器)     │
                    └─────────────────┬───────────────────┘
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
        ▼                             ▼                             ▼
┌───────────────────┐       ┌─────────────────┐         ┌─────────────────┐
│   🎨 UI Layer     │       │  🤖 AI Layer    │         │ 📊 Data Layer   │
├───────────────────┤       ├─────────────────┤         ├─────────────────┤
│ SearchHomePage    │       │ OllamaManager   │         │ DataManager     │
│ SearchBar         │       │ AIChat          │         │ GooglePlaces    │
│ RightPanel        │       │ ChatHistory     │         │ FirebaseExpense │
│ TabManager        │       │ AIProgress      │         │ RatingAnalyzer  │
│ RecentReviews     │       │ ChatAdvisor     │         │ AlgoliaSearch   │
│ UIManager         │       │ FirestoreAnalyzer│        │                │
│ AnimationManager  │       │ AIIntegration   │         │                │
│ PreferencesManager│       │                 │         │                │
│ ResourceManager   │       │                 │         │                │
└───────────────────┘       └─────────────────┘         └─────────────────┘
                                      │
                            ┌─────────▼─────────┐
                            │  🐍 Python Layer  │
                            ├───────────────────┤
                            │ featured_collector│
                            │ rating_analyzer   │
                            │ restaurant.py     │
                            │ utils.py          │
                            │ review.py         │
                            └───────────────────┘
```

---

## 🔄 數據流程圖

```
        用戶輸入餐廳名稱
               │
               ▼
    ┌─────────────────────┐
    │    SearchBar        │ ◄─── 即時搜索建議
    │   智能搜索處理       │
    └──────────┬──────────┘
               │
               ▼
    ┌─────────────────────┐      ┌─────────────────┐
    │   本地快取檢查       │ YES  │   直接載入數據   │
    │  (JSON Files)      │ ───► │   顯示結果      │
    └──────────┬──────────┘      └─────────────────┘
               │ NO
               ▼
    ┌─────────────────────┐
    │    多源數據搜索      │
    ├─────────────────────┤
    │ • Google Places     │
    │ • Firebase          │
    │ • Algolia           │
    └──────────┬──────────┘
               │
               ▼
    ┌─────────────────────┐      ┌─────────────────┐
    │   數據收集和清洗     │      │  Python 爬蟲    │
    │  (DataManager)     │ ───► │ featured_collector│
    └──────────┬──────────┘      └─────────┬───────┘
               │                          │
               │                          ▼
               │                 ┌─────────────────┐
               │                 │ 🌟 在地嚮導優先 │
               │                 │ 權威性+20%加分  │
               │                 │ 門檻0.5→0.3    │
               │                 └─────────────────┘
               │
               ▼
    ┌─────────────────────┐
    │   數據分析處理       │
    ├─────────────────────┤
    │ • 評分統計分析       │
    │ • 評論情感分析       │
    │ • 趨勢預測分析       │
    └──────────┬──────────┘
               │
               ▼
    ┌─────────────────────┐      ┌─────────────────┐
    │    界面顯示更新      │      │   AI 智能建議    │
    │  (RightPanel)      │ ◄──► │ (OllamaManager) │
    └─────────────────────┘      └─────────────────┘
```

---

## 📚 技術架構分層

### 🎨 展示層 (Presentation Layer)
**負責**: 用戶界面顯示和交互處理
- **UI 控制器**: `compare.java`、`SearchHomePage.java`、`AIChat.java`
- **界面組件**: `SearchBar.java`、`RightPanel.java`、`TabManager.java`
- **樣式管理**: `UIManager.java`、`AnimationManager.java`
- **資源管理**: `ResourceManager.java`、CSS 樣式檔案

### 💼 業務邏輯層 (Business Logic Layer)
**負責**: 核心業務邏輯和規則處理
- **數據管理**: `DataManager.java`、`RatingDataAnalyzer.java`
- **AI 處理**: `OllamaManager.java`、`AIAnalysisIntegration.java`
- **搜索邏輯**: `AlgoliaRestaurantSearch.java`
- **偏好管理**: `PreferencesManager.java`

### 💾 數據存取層 (Data Access Layer)
**負責**: 數據的存取和持久化
- **雲端服務**: `GooglePlacesService.java`、`FirebaseExpenseManager.java`
- **本地快取**: JSON 檔案、Preferences 存儲
- **AI 服務**: Ollama API 整合
- **搜索服務**: Algolia API 整合

### 🔧 基礎設施層 (Infrastructure Layer)
**負責**: 系統運行的基礎支援
- **應用啟動**: `AppLauncher.java`、`CustomSplashScreen.java`
- **資源管理**: `ResourceManager.java`
- **錯誤處理**: 各模組的異常處理機制
- **日誌系統**: 系統日誌和監控

### 🐍 數據收集層 (Data Collection Layer)
**負責**: 外部數據的收集和處理
- **爬蟲模組**: `featured_collector.py`、`restaurant.py`
- **數據分析**: `rating_analyzer.py`、`review.py`
- **工具函數**: `utils.py`、`config.py`

---

## 🌐 外部服務整合架構

```
┌──────────────────────────────────────────────────────────────────┐
│                     🌟 餐廳分析器核心系統                        │
└─────────────────────────┬────────────────────────────────────────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
   │  🔥 Firebase │ │ 🅖 Google   │ │ 🔍 Algolia  │
   │   服務整合   │ │   API 整合  │  │   搜索整合    │
   └─────────────┘ └─────────────┘ └─────────────┘
   │             │ │             │ │             │
   │ • Firestore │ │ • Places    │ │ • Search    │
   │ • Storage   │ │ • Maps      │ │ • Index     │
   │ • Real-time │ │ • Reviews   │ │ • Analytics │
   └─────────────┘ └─────────────┘ └─────────────┘
          │               │               │
          └───────────────┼───────────────┘
                          │
                          ▼
                ┌─────────────────┐
                │   🤖 Ollama AI  │
                │    本地 AI 引擎  │
                └─────────────────┘
                │               │
                │ • Gemma 3:4B  │
                │ • 本地推理    │
                │ • 對話管理    │
                └─────────────────┘
```

---

## 📦 部署架構

### Windows 零安裝版本架構
```
📁 RestaurantAnalyzer-ZeroInstall-1.0.0/
├── 📁 app/                           # Java 主應用程式
│   ├── 📁 src/                       # 源代碼
│   ├── 📁 build/                     # 編譯輸出
│   ├── 📄 build.gradle               # 建構配置
│   └── 📄 requirements.txt           # Python 依賴
├── 📁 jdk-21/                        # 內建 Java Runtime
│   ├── 📁 bin/                       # Java 執行檔
│   ├── 📁 lib/                       # Java 函式庫
│   └── 📁 conf/                      # Java 配置
├── 📁 python-3.11/                   # 內建 Python 環境
│   ├── 📁 Scripts/                   # Python 執行檔
│   ├── 📁 Lib/                       # Python 函式庫
│   └── 📁 DLLs/                      # Python DLL
├── 📁 .venv/                         # Python 虛擬環境
│   ├── 📁 Scripts/                   # 虛擬環境執行檔
│   └── 📁 Lib/                       # 虛擬環境函式庫
├── 📄 RestaurantAnalyzer.bat         # Windows 啟動腳本
├── 📄 README.txt                     # 使用說明
└── 📄 config.properties              # 應用程式配置
```

### macOS 版本架構
```
📁 RestaurantAnalyzer.dmg
└── 📁 RestaurantAnalyzer.app         # macOS 應用程式包
    └── 📁 Contents/
        ├── 📄 Info.plist             # 應用程式資訊
        ├── 📁 MacOS/                 # 執行檔
        ├── 📁 Resources/             # 資源檔案
        │   ├── 📄 app.icns          # 應用程式圖示
        │   └── 📁 java/             # Java 運行環境
        └── 📁 Java/                  # Java 應用程式
```

### 系統需求和相容性
- **Windows**: Windows 10/11 (64位元)
- **macOS**: macOS 10.14 Mojave 或更新版本
- **記憶體**: 最少 4GB RAM (建議 8GB 以上)
- **磁碟空間**: 500MB 可用空間
- **網路**: 穩定的網際網路連線 (用於雲端服務)
- **顯示**: 最低解析度 1280x720 (建議 1920x1080)

---

## 🎯 架構設計優勢

### 🔧 模組化設計
- **高內聚低耦合**: 每個模組職責明確，相互依賴最小化
- **可擴展性**: 易於新增功能模組和服務整合
- **可維護性**: 模組獨立開發、測試和部署
- **可重用性**: 核心組件可在不同情境下重複使用

### ⚡ 效能優化策略
- **多層快取機制**: 記憶體快取、檔案快取、網路快取
- **非同步處理**: 大量使用 CompletableFuture 進行非同步操作
- **資源管理**: 智能的資源載入和釋放機制
- **載入優化**: 延遲載入和按需載入策略

### 🔒 安全設計原則
- **API 金鑰保護**: 加密存儲和安全傳輸 API 金鑰
- **本地數據保護**: 敏感數據的本地加密存儲
- **網路安全**: HTTPS 通訊和憑證驗證
- **輸入驗證**: 嚴格的用戶輸入驗證和清理

### 🌟 用戶體驗設計
- **零安裝部署**: 免安裝即可使用，降低使用門檻
- **響應式設計**: 自適應不同螢幕尺寸和解析度
- **智能交互**: AI 驅動的智能建議和操作提示
- **視覺反饋**: 豐富的動畫效果和狀態指示

這個完整的架構設計確保了餐廳分析器的穩定性、可擴展性、安全性和優秀的用戶體驗，為餐廳經營者提供了一個功能強大且易於使用的分析工具。 