# AI 自動初始化功能說明

## 功能概述

為了提供更好的使用者體驗，我們實現了 AI 模型的自動初始化功能。使用者在下載並啟動程式後，系統會自動檢查並下載必要的 AI 組件，無需手動操作。

## 新增的檔案

### 1. `AIProgressDialog.java`
- **位置**: `src/main/java/bigproject/ai/AIProgressDialog.java`
- **功能**: 顯示 AI 初始化進度的對話框
- **特色**:
  - 美觀的進度條界面
  - 即時狀態更新
  - 詳細的進度說明
  - 可取消和隱藏功能
  - 錯誤處理和回饋

### 2. `AIProgressDialogTest.java`
- **位置**: `src/main/java/bigproject/ai/AIProgressDialogTest.java`
- **功能**: 獨立測試進度條功能的程式

## 自動初始化流程

### 啟動時機
- 程式啟動後，所有 UI 動畫完成時（約 3 秒後）
- 自動在背景檢查 AI 組件狀態
- 只有在需要時才顯示進度對話框

### 檢查邏輯
1. **快速檢查**: 在背景執行緒中檢查是否需要初始化
2. **智能判斷**: 
   - 如果 Ollama 已安裝且模型已下載 → 靜默完成
   - 如果需要下載 → 顯示進度對話框
3. **使用者友善**: 已下載的組件不會重複下載

### 進度顯示階段

1. **檢查 Ollama 安裝狀態** (0-10%)
   - 檢查本地是否已安裝 Ollama

2. **下載 Ollama** (10-50%)
   - 如果未安裝，從官方網站下載 Ollama (約 50MB)
   - 顯示下載進度

3. **啟動 Ollama 服務** (50-70%)
   - 啟動本地 AI 服務
   - 確認服務正常運行

4. **檢查 AI 模型** (70-80%)
   - 檢查 gemma3:4b 模型是否已下載

5. **下載 AI 模型** (80-95%)
   - 如果模型未下載，開始下載 gemma3:4b (4GB)
   - 顯示下載進度和預估時間

6. **完成初始化** (95-100%)
   - 確認所有組件就緒
   - 靜默完成，不打擾使用者

## 使用者體驗改進

### ✅ **第一次使用**
- 程式啟動後自動開始下載
- 清楚的進度顯示和狀態說明
- 可以隱藏對話框繼續使用其他功能
- 下載完成後靜默完成

### ✅ **已安裝使用者**
- 快速檢查，幾乎無感知
- 不會顯示不必要的對話框
- 程式啟動更流暢

### ✅ **錯誤處理**
- 網路問題或下載失敗時的友善提示
- 不會阻塞程式的其他功能
- 可以稍後重新嘗試

## 技術實現

### 背景檢查
```java
// 在背景執行緒中快速檢查
boolean needsInitialization = !manager.isOllamaInstalled() || 
                             !manager.isModelDownloaded("gemma3:4b");
```

### 智能顯示
- 只有在真正需要下載時才顯示進度對話框
- 已安裝的組件會被跳過
- 使用非阻塞的 UI 更新

### 錯誤處理
- 失敗時顯示簡潔的警告訊息
- 不會強制中斷使用者的工作流程
- 錯誤詳情記錄在控制台中

## 測試方式

### 測試自動初始化
1. 刪除現有的 Ollama 安裝：`rm -rf ~/.ollama`
2. 啟動程式：`./gradlew run`
3. 等待約 3 秒，觀察是否自動顯示進度對話框

### 測試已安裝情況
1. 確保 Ollama 和模型已安裝
2. 啟動程式：`./gradlew run`
3. 應該不會顯示進度對話框，在控制台看到 "AI 功能已就緒"

### 獨立測試進度條
```bash
./gradlew run -PmainClass=bigproject.ai.AIProgressDialogTest
```

## 配置選項

### 環境變數
- `OLLAMA_MODEL`: 指定要下載的模型（預設：gemma3:4b）

### 系統需求
- **網路連線**: 首次下載需要穩定的網路連線
- **磁碟空間**: 至少 5GB 可用空間（Ollama + 模型）
- **記憶體**: 建議 8GB 以上 RAM

## 故障排除

### 常見問題
1. **下載速度慢**: 模型檔案較大（4GB），請耐心等待
2. **網路錯誤**: 檢查網路連線，可稍後重新啟動程式
3. **磁碟空間不足**: 清理磁碟空間後重新嘗試

### 手動重置
如果遇到問題，可以手動重置：
```bash
# 刪除 Ollama 安裝
rm -rf ~/.ollama

# 重新啟動程式
./gradlew run
```

## 未來改進

- [ ] 顯示實際的下載速度和剩餘時間
- [ ] 支援暫停和恢復下載
- [ ] 支援選擇不同的 AI 模型
- [ ] 離線模式支援 